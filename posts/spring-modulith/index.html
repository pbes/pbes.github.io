<!DOCTYPE html><html lang="en" class="text-zinc-800"> <head><!-- Global Metadata --><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" type="image/png" href="/favicon.png"><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&family=Familjen+Grotesk:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500;1,600;1,700&family=Noto+Sans:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet"><!-- Canonical URL --><link rel="canonical" href="https://pbes.github.io/posts/spring-modulith"><!-- Google tag (gtag.js) --><script async src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXXXXX"></script><!-- Primary Meta Tags --><title>Spring Modulith ¬∑ pbes blog</title><meta name="title" content="Spring Modulith ¬∑ pbes blog"><meta name="description" content="A mikroszerv√≠z egy men≈ë hype, de nem √©rdemes m√©g temetn√ºnk a j√≥ √∂reg monolitikus alkalmaz√°sokat"><!-- Open Graph / Facebook --><meta property="og:type" content="website"><meta property="og:url" content="https://pbes.github.io/posts/spring-modulith"><meta property="og:title" content="Spring Modulith ¬∑ pbes blog"><meta property="og:description" content="A mikroszerv√≠z egy men≈ë hype, de nem √©rdemes m√©g temetn√ºnk a j√≥ √∂reg monolitikus alkalmaz√°sokat"><!-- Twitter --><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://pbes.github.io/posts/spring-modulith"><meta property="twitter:title" content="Spring Modulith ¬∑ pbes blog"><meta property="twitter:description" content="A mikroszerv√≠z egy men≈ë hype, de nem √©rdemes m√©g temetn√ºnk a j√≥ √∂reg monolitikus alkalmaz√°sokat"><meta name="astro-view-transitions-enabled" content="true"><meta name="astro-view-transitions-fallback" content="animate"><link rel="stylesheet" href="/_astro/about.B12WitEq.css">
<link rel="stylesheet" href="/_astro/_slug_.D70-yzNw.css"><script type="module" src="/_astro/hoisted.Bk9VN7UM.js"></script>
<script type="module" src="/_astro/page.BNYwb576.js"></script></head> <body> <div class="flex flex-col h-full mb-8 overflow-y-scroll antialiased"> <header class="sticky z-50 top-0 bg-white/80 backdrop-blur-xl transition-all select-none bg-gradient-to-b from-orange-50"> <div class="flex flex-row gap-8 items-center justify-between max-w-screen-md mx-auto h-24 px-4 sm:px-6"> <a href="/" class="flex flex-row items-center justify-center gap-2"> <img src="/avatar.jpg" alt="author avatar" class="w-10 rounded-full aspect-square"> <span class="text-orange-600 font-title font-black">pbes blog</span> </a> <div class="flex flex-row gap-4" id="menu-items"> <a href="/posts" target="_self" class="h-full text-sm hover:text-orange-700"> Bejegyz√©sek </a><a href="/tags" target="_self" class="h-full text-sm hover:text-orange-700"> C√≠mk√©k </a><a href="/date" target="_self" class="h-full text-sm hover:text-orange-700"> Arch√≠vum </a><a href="/about" target="_self" class="h-full text-sm hover:text-orange-700"> R√≥lam </a><a href="https://github.com/pbes" target="_blank" class="h-full text-sm hover:text-orange-700"> GitHub </a> </div> </div> </header> <div class="flex-auto">  <div class="flex flex-col gap-8 md:w-5/6 px-4 py-12 sm:px-8 mx-auto"> <div class="flex flex-col gap-6 items-center justify-center max-w-screen-sm mx-auto"> <h1 id="header" class="text-5xl text-center font-title font-black">Spring Modulith</h1> <div class="flex items-center justify-center gap-2"> <a href="/date/2024" target="_self" class="px-2.5 py-1 rounded-lg text-xs bg-zinc-50"> December 16, 2024 </a> <a href="/tags/architecture" target="_self" class="px-2.5 py-1 rounded-lg text-xs text-red-600 font-medium bg-red-50/80 capitalize"> architecture </a><a href="/tags/Java" target="_self" class="px-2.5 py-1 rounded-lg text-xs text-red-600 font-medium bg-red-50/80 capitalize"> Java </a><a href="/tags/Spring" target="_self" class="px-2.5 py-1 rounded-lg text-xs text-red-600 font-medium bg-red-50/80 capitalize"> Spring </a> </div> <p class="text-lg text-center text-zinc-700 max-w-[480px]">A mikroszerv√≠z egy men≈ë hype, de nem √©rdemes m√©g temetn√ºnk a j√≥ √∂reg monolitikus alkalmaz√°sokat</p> </div> <img src="/images/spring-modulith/spring-modulith-cover.jpg?w=1200&#38;q=80" alt="cover" class="w-full max-w-screen-md mx-auto rounded-lg"> </div> <div class="relative flex flex-col gap-2 max-w-screen-md mx-auto px-4 sm:px-6 text-base text-zinc-700"> <p> Viczi√°n Istv√°nn√°l olvastam err≈ël a koncepci√≥r√≥l: </p>
<ul class="list-disc ml-6"> 
<li class="mb-1"> <a href="https://www.jtechlog.hu/2022/12/19/spring-modulith.html" href="https://www.jtechlog.hu/2022/12/19/spring-modulith.html" class="text-blue-600 after:content-['_‚Üó']" target="_blank" rel="noopener noreferrer"> https://www.jtechlog.hu/2022/12/19/spring-modulith.html </a> </li>
<li class="mb-1"> <a href="https://www.jtechlog.hu/2024/07/24/spring-modulith-esemenyek.html" href="https://www.jtechlog.hu/2024/07/24/spring-modulith-esemenyek.html" class="text-blue-600 after:content-['_‚Üó']" target="_blank" rel="noopener noreferrer"> https://www.jtechlog.hu/2024/07/24/spring-modulith-esemenyek.html </a> </li>
 </ul>
<p> √ögy gondoltam, hogy el is menthetn√©m a cikkeket, de sokkal jobban megmarad, ha k√©sz√≠tek r√° √©n is egy p√©lda projektet. </p>
<p> A mikroszerv√≠zek nagyon n√©pszer≈±ek. Ha m√°s√©rt nem is, az√©rt, hogy az emberek be√≠rhass√°k a CV-j√ºkbe, de sok szempontb√≥l bonyolultabb√° teszik a munk√°t, mint egy monolit alkalmaz√°s. A service-ek f√ºggetlens√©g√©t kell garant√°lnunk, k√ºl√∂nben csak egy elosztott monolitot k√©sz√≠t√ºnk, amely m√©g nehezebben karbantarthat√≥, mint egy hagyom√°nyos monolit: egyszerre kell fejleszteni, egyszerre kell az √∫j verzi√≥kat deployolni, nem ind√≠that√≥ egyetlen paranccsal. </p>
<p> A hagyom√°nyos monolittal az a probl√©ma, hogy amint legacy-v√° v√°lik a k√≥d √©s a logika olyan bonyolult, minden m√≥dos√≠t√°s vesz√©lyess√© v√°lhat. Ha hozz√°adunk egy ‚ÄúB‚Äù feature-t, elk√©pzelhet≈ë, hogy megfelel≈ë tesztel√©s hi√°ny√°ban, ‚ÄúA‚Äù elromlik. Szerencs√©re a Spring Modulith projekt k√©pes seg√≠teni minket abban, hogy egyetlen monolitikus alkalmaz√°son bel√ºl szepar√°ljuk a k√ºl√∂nb√∂z≈ë √ºzleti funkci√≥kat, amelyek √≠gy nem keverednek, sokkal tiszt√°bb logik√°t kaphatunk. </p>
<p> Az alap√∂tlet: </p>
<ul class="list-disc ml-6"> 
<li class="mb-1"> a projekt legfels≈ë szint≈± package-ei lesznek a modulok </li>
<li class="mb-1"> 1 modul egy m√°sik modul publikus interf√©sz√©t h√≠vhatja, nem enged√©lyezett a bels≈ë logika el√©r√©se </li>
<li class="mb-1"> nem enged√©lyezett a k√∂rk√∂r√∂s f√ºgg≈ës√©g </li>
 </ul>
<p> <div src="/images/spring-modulith/modulith_01.png" alt="Spring Modulith f√ºgg≈ës√©gi gr√°f" class="flex flex-col gap-2 text-center"> <img class="w-full rounded-lg overflow-clip" src="/images/spring-modulith/modulith_01.png?w=1024&#38;q=70" alt="Spring Modulith f√ºgg≈ës√©gi gr√°f"> <span class="text-gray-400 font-normal text-sm">Spring Modulith f√ºgg≈ës√©gi gr√°f</span> </div> </p>
<p> Mit √©rt√ºnk publikus interf√©sz alatt? </p>
<ul class="list-disc ml-6"> 
<li class="mb-1"> a package legfels≈ë szint≈± oszt√°lyait </li>
<li class="mb-1"> azon oszt√°lyokat, amelyeket explicit m√≥don publikuss√° tesz√ºnk neves√≠tve a <code>package-info.java</code> f√°jlban </li>
 </ul>
<p> A fenti p√©ld√°n: </p>
<ul class="list-disc ml-6"> 
<li class="mb-1"> a Modul 1 h√≠vhatja a Modul 2 API interf√©sz√©t </li>
<li class="mb-1"> a Modul 1 nem h√≠vhatja k√∂zvetlen√ºl a Modul 2 bels≈ë oszt√°lyait </li>
<li class="mb-1"> a Modul 2 nem h√≠vhatja a Modul 1-et, mert k√∂rk√∂r√∂s f√ºgg≈ës√©g alakulna ki </li>
 </ul>
<p> Ezekkel a megk√∂t√©sekkel eg√©szen j√≥l el tudjuk szepar√°lni az egyes √ºzleti ter√ºleteket √©s a hozz√°juk kapcsol√≥d√≥ logik√°t. Az egyes modulok egym√°s k√∂z√∂tt esem√©nyekkel tudnak kommunik√°lni, mely a Spring r√©sz√©t k√©pez≈ë <code>ApplicationEventPublisher</code> seg√≠ts√©g√©vel t√∂rt√©nik. </p>
<h2 id="p√©lda-projekt" class="text-2xl font-bold my-2"> P√©lda projekt </h2>
<h3 id="esem√©nyek-kezel√©se" class="text-xl font-bold my-2"> Esem√©nyek kezel√©se </h3>
<p> A p√©lda projektben 2 modul tal√°lhat√≥: </p>
<ul class="list-disc ml-6"> 
<li class="mb-1"> <code>order</code> a rendel√©sek kezel√©s√©√©rt felel≈ës </li>
<li class="mb-1"> <code>shipment</code> a sz√°ll√≠t√°sok kezel√©s√©√©rt felel≈ës </li>
 </ul>
<p> Az <code>order</code> modul kontrollere 2 endpointot publik√°l: </p>
<ul class="list-disc ml-6"> 
<li class="mb-1"> <code>POST /orders</code>: √∫j rendel√©s l√©trehoz√°sa </li>
<li class="mb-1"> <code>DELETE /orders/{id}</code>: rendel√©s t√∂rl√©se (ami megtehet≈ë addig, am√≠g a sz√°ll√≠t√°s nem indult el) </li>
 </ul>
<p> A <code>CreateOrderAction</code> oszt√°lyban a rendel√©s l√©trehoz√°sa ut√°n l√©trehozzuk az <code>OrderCreatedEvent</code> esem√©nyt, melyet az <code>ApplicationEventPublisher</code> dob sz√©t az alkalmaz√°s t√∂bbi r√©sze fel√©: </p>
<pre class="astro-code github-light" style="background-color:#fff;color:#24292e;overflow-x:auto" tabindex="0" data-language="java"><code><span class="line"><span style="color:#24292E">@</span><span style="color:#D73A49">Transactional</span><span style="color:#24292E">(Transactional.TxType.REQUIRED)</span></span>
<span class="line"><span style="color:#D73A49">public</span><span style="color:#24292E"> OrderDTO </span><span style="color:#6F42C1">execute</span><span style="color:#24292E">(CreateOrderDTO createOrderDTO) {</span></span>
<span class="line"><span style="color:#D73A49">    final</span><span style="color:#D73A49"> var</span><span style="color:#24292E"> order </span><span style="color:#D73A49">=</span><span style="color:#D73A49"> new</span><span style="color:#6F42C1"> Order</span><span style="color:#24292E">();</span></span>
<span class="line"><span style="color:#24292E">    order.</span><span style="color:#6F42C1">setState</span><span style="color:#24292E">(OrderState.CREATED);</span></span>
<span class="line"><span style="color:#24292E">    order.</span><span style="color:#6F42C1">setUserId</span><span style="color:#24292E">(createOrderDTO.</span><span style="color:#6F42C1">getUserId</span><span style="color:#24292E">());</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">    final</span><span style="color:#D73A49"> var</span><span style="color:#24292E"> savedOrder </span><span style="color:#D73A49">=</span><span style="color:#24292E"> orderRepository.</span><span style="color:#6F42C1">save</span><span style="color:#24292E">(order);</span></span>
<span class="line"><span style="color:#24292E">    eventPublisher.</span><span style="color:#6F42C1">publishEvent</span><span style="color:#24292E">(</span><span style="color:#D73A49">new</span><span style="color:#6F42C1"> OrderCreatedEvent</span><span style="color:#24292E">(</span><span style="color:#005CC5">this</span><span style="color:#24292E">, savedOrder.</span><span style="color:#6F42C1">getId</span><span style="color:#24292E">()));</span></span>
<span class="line"><span style="color:#D73A49">    return</span><span style="color:#24292E"> orderMapper.</span><span style="color:#6F42C1">map</span><span style="color:#24292E">(savedOrder, OrderDTO.class);</span></span>
<span class="line"><span style="color:#24292E">}</span></span>
<span class="line"></span></code></pre>
<p> A <code>shipment</code> modulban az <code>OrderCreatedHandler</code> oszt√°ly figyeli az <code>OrderCreatedEvent</code> esem√©nyt, ezt az <code>EventListener</code> annot√°ci√≥val adhatjuk meg √©s l√©trehoz egy sz√°ll√≠tm√°nyt l√©trehozott √°llapotban: </p>
<pre class="astro-code github-light" style="background-color:#fff;color:#24292e;overflow-x:auto" tabindex="0" data-language="java"><code><span class="line"><span style="color:#24292E">@</span><span style="color:#D73A49">EventListener</span></span>
<span class="line"><span style="color:#D73A49">public</span><span style="color:#D73A49"> void</span><span style="color:#6F42C1"> handleOrderCreated</span><span style="color:#24292E">(OrderCreatedEvent event) {</span></span>
<span class="line"><span style="color:#24292E">    log.</span><span style="color:#6F42C1">info</span><span style="color:#24292E">(</span><span style="color:#032F62">&quot;Order created: {}&quot;</span><span style="color:#24292E">, event.</span><span style="color:#6F42C1">getOrderId</span><span style="color:#24292E">());</span></span>
<span class="line"><span style="color:#D73A49">    final</span><span style="color:#D73A49"> var</span><span style="color:#24292E"> shipment </span><span style="color:#D73A49">=</span><span style="color:#D73A49"> new</span><span style="color:#6F42C1"> Shipment</span><span style="color:#24292E">();</span></span>
<span class="line"><span style="color:#24292E">    shipment.</span><span style="color:#6F42C1">setOrderId</span><span style="color:#24292E">(event.</span><span style="color:#6F42C1">getOrderId</span><span style="color:#24292E">());</span></span>
<span class="line"><span style="color:#24292E">    shipment.</span><span style="color:#6F42C1">setState</span><span style="color:#24292E">(ShipmentState.CREATED);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">    final</span><span style="color:#D73A49"> var</span><span style="color:#24292E"> savedShipment </span><span style="color:#D73A49">=</span><span style="color:#24292E"> shipmentRepository.</span><span style="color:#6F42C1">save</span><span style="color:#24292E">(shipment);</span></span>
<span class="line"><span style="color:#24292E">    eventPublisher.</span><span style="color:#6F42C1">publishEvent</span><span style="color:#24292E">(</span><span style="color:#D73A49">new</span><span style="color:#6F42C1"> ShipmentCreatedEvent</span><span style="color:#24292E">(</span><span style="color:#005CC5">this</span><span style="color:#24292E">, savedShipment.</span><span style="color:#6F42C1">getId</span><span style="color:#24292E">()));</span></span>
<span class="line"><span style="color:#24292E">}</span></span>
<span class="line"></span></code></pre>
<p> Ezen fel√ºl a Spring Modulith teszt-eszk√∂z√∂ket is ad nek√ºnk, melyekkel automatiz√°ltan ellen≈ërizhetj√ºk a modulok k√∂z√∂tti f√ºgg≈ës√©gi gr√°f helyess√©g√©t: </p>
<pre class="astro-code github-light" style="background-color:#fff;color:#24292e;overflow-x:auto" tabindex="0" data-language="java"><code><span class="line"><span style="color:#D73A49">public</span><span style="color:#D73A49"> class</span><span style="color:#6F42C1"> ModulesTest</span><span style="color:#24292E"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">    @</span><span style="color:#D73A49">Test</span></span>
<span class="line"><span style="color:#D73A49">    public</span><span style="color:#D73A49"> void</span><span style="color:#6F42C1"> testModuleStructure</span><span style="color:#24292E">() {</span></span>
<span class="line"><span style="color:#D73A49">        final</span><span style="color:#D73A49"> var</span><span style="color:#24292E"> modules </span><span style="color:#D73A49">=</span><span style="color:#24292E"> ApplicationModules.</span><span style="color:#6F42C1">of</span><span style="color:#24292E">(ModulithExampleApplication.class);</span></span>
<span class="line"><span style="color:#D73A49">        new</span><span style="color:#6F42C1"> Documenter</span><span style="color:#24292E">(modules)</span></span>
<span class="line"><span style="color:#24292E">                .</span><span style="color:#6F42C1">writeModulesAsPlantUml</span><span style="color:#24292E">()</span></span>
<span class="line"><span style="color:#24292E">                .</span><span style="color:#6F42C1">writeIndividualModulesAsPlantUml</span><span style="color:#24292E">();</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">}</span></span>
<span class="line"></span></code></pre>
<h3 id="aszinkron-esem√©nyek" class="text-xl font-bold my-2"> Aszinkron esem√©nyek </h3>
<p> A fenti esem√©nykezel≈ë az esem√©nyt l√©trehoz√≥ k√≥ddal egy k√∂z√∂s tranzakci√≥ban fut √©s am√≠g nem siker√ºl lez√°rni, az eredeti k√≥d sem tud visszat√©rni az eredm√©nnyel. Lehet≈ës√©g√ºnk van az <code>@Async</code>, a <code>@TransactionalEventListener</code> √©s a <code>@Transactional(propagation = Propagation.REQUIRES_NEW)</code> annot√°ci√≥kkal aszinkron, k√ºl√∂n tranzakci√≥ban fut√≥ esem√©nykezel≈ëv√© alak√≠tani: </p>
<pre class="astro-code github-light" style="background-color:#fff;color:#24292e;overflow-x:auto" tabindex="0" data-language="java"><code><span class="line"><span style="color:#24292E">@</span><span style="color:#D73A49">Async</span></span>
<span class="line"><span style="color:#24292E">@</span><span style="color:#D73A49">TransactionalEventListener</span></span>
<span class="line"><span style="color:#24292E">@</span><span style="color:#D73A49">Transactional</span><span style="color:#24292E">(</span><span style="color:#005CC5">propagation</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> Propagation.REQUIRES_NEW)</span></span>
<span class="line"><span style="color:#D73A49">public</span><span style="color:#D73A49"> void</span><span style="color:#6F42C1"> handleOrderCreated</span><span style="color:#24292E">(OrderCreatedEvent event) {</span></span>
<span class="line"><span style="color:#24292E">    ...</span></span>
<span class="line"><span style="color:#24292E">}</span></span>
<span class="line"></span></code></pre>
<p> Ezt a 3 annot√°ci√≥t v√°ltja ki a <code>spring-modulith-events-api</code>-ban defini√°lt <code>@ApplicationModuleListener</code> annot√°ci√≥: </p>
<pre class="astro-code github-light" style="background-color:#fff;color:#24292e;overflow-x:auto" tabindex="0" data-language="xml"><code><span class="line"><span style="color:#24292E">&lt;</span><span style="color:#22863A">dependency</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">	&lt;</span><span style="color:#22863A">groupId</span><span style="color:#24292E">&gt;org.springframework.modulith&lt;/</span><span style="color:#22863A">groupId</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">	&lt;</span><span style="color:#22863A">artifactId</span><span style="color:#24292E">&gt;spring-modulith-events-api&lt;/</span><span style="color:#22863A">artifactId</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">&lt;/</span><span style="color:#22863A">dependency</span><span style="color:#24292E">&gt;</span></span>
<span class="line"></span></code></pre>
<h3 id="esem√©nyek-ment√©se" class="text-xl font-bold my-2"> Esem√©nyek ment√©se </h3>
<p> M√©g mindig nem teljes a megold√°sunk: amennyiben az alkalmaz√°s le√°ll vagy a shipment modulban nem fut le az esem√©nykezel≈ë, sz√ºks√©g√ºnk lehet arra, hogy ments√ºk az esem√©nyt √©s √∫jrapr√≥b√°ljuk a feldolgoz√°s√°t. </p>
<p> Ehhez els≈ë l√©p√©sben menten√ºnk kell, az Event Publication Repository-t az al√°bbi <code>pom.xml</code> f√ºgg≈ës√©ggel vehetj√ºk fel: </p>
<pre class="astro-code github-light" style="background-color:#fff;color:#24292e;overflow-x:auto" tabindex="0" data-language="xml"><code><span class="line"><span style="color:#24292E">&lt;</span><span style="color:#22863A">dependency</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">    &lt;</span><span style="color:#22863A">groupId</span><span style="color:#24292E">&gt;org.springframework.modulith&lt;/</span><span style="color:#22863A">groupId</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">    &lt;</span><span style="color:#22863A">artifactId</span><span style="color:#24292E">&gt;spring-modulith-starter-jpa&lt;/</span><span style="color:#22863A">artifactId</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">&lt;/</span><span style="color:#22863A">dependency</span><span style="color:#24292E">&gt;</span></span>
<span class="line"></span></code></pre>
<p> Amennyiben nem a Hibernate-re b√≠zzuk a t√°bl√°k l√©trehoz√°s√°t, hanem Flyway-t vagy Liquibase-t haszn√°lunk, nek√ºnk kell k√©zzel l√©trehozni az event_publication √©s az event_publication_archive t√°bl√°kat: <a href="https://docs.spring.io/spring-modulith/docs/current-SNAPSHOT/reference/html/#appendix.schemas" href="https://docs.spring.io/spring-modulith/docs/current-SNAPSHOT/reference/html/#appendix.schemas" class="text-blue-600 after:content-['_‚Üó']" target="_blank" rel="noopener noreferrer"> https://docs.spring.io/spring-modulith/docs/current-SNAPSHOT/reference/html/#appendix.schemas </a> </p>
<p> Ehhez re-publik√°lni kell, amelyet megtehet√ºnk: </p>
<ul class="list-disc ml-6"> 
<li class="mb-1"> deklarat√≠van: </li>
 </ul>
<p> Az <code>application.yml</code>-ben a k√∂vetkez≈ë be√°ll√≠t√°sokkal: </p>
<pre class="astro-code github-light" style="background-color:#fff;color:#24292e;overflow-x:auto" tabindex="0" data-language="yaml"><code><span class="line"><span style="color:#22863A">spring</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#22863A">  modulith</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#22863A">    republish-outstanding-events-on-restart</span><span style="color:#24292E">: </span><span style="color:#005CC5">true</span></span>
<span class="line"></span></code></pre>
<ul class="list-disc ml-6"> 
<li class="mb-1"> programozottan: a <code>IncompleteEventPublications</code> oszt√°ly haszn√°lat√°val </li>
 </ul>
<pre class="astro-code github-light" style="background-color:#fff;color:#24292e;overflow-x:auto" tabindex="0" data-language="java"><code><span class="line"><span style="color:#24292E">@</span><span style="color:#D73A49">Service</span></span>
<span class="line"><span style="color:#24292E">@</span><span style="color:#D73A49">RequiredArgsConstructor</span></span>
<span class="line"><span style="color:#D73A49">public</span><span style="color:#D73A49"> class</span><span style="color:#6F42C1"> EventCleanupService</span><span style="color:#24292E"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">    private</span><span style="color:#D73A49"> final</span><span style="color:#24292E"> IncompleteEventPublications incompleteEventPublications;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">    @</span><span style="color:#D73A49">Scheduled</span><span style="color:#24292E">(</span><span style="color:#005CC5">fixedRate</span><span style="color:#D73A49"> =</span><span style="color:#005CC5"> 10000</span><span style="color:#24292E">)</span></span>
<span class="line"><span style="color:#D73A49">    public</span><span style="color:#D73A49"> void</span><span style="color:#6F42C1"> republishIncompleteEvents</span><span style="color:#24292E">() {</span></span>
<span class="line"><span style="color:#24292E">        incompleteEventPublications.</span><span style="color:#6F42C1">resubmitIncompletePublicationsOlderThan</span><span style="color:#24292E">(Duration.ZERO);</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">}</span></span>
<span class="line"></span></code></pre>
<p> A befejezett esem√©nyeket a <code>CompletedEventPublications</code> seg√≠ts√©g√©vel list√°zhatjuk √©s t√∂r√∂lhetj√ºk. </p>
<h3 id="esem√©nyek-externaliz√°l√°sa-megoszt√°sa-m√°s-service-ekkel" class="text-xl font-bold my-2"> Esem√©nyek externaliz√°l√°sa, megoszt√°sa m√°s service-ekkel </h3>
<p> Amennyiben az esem√©nyeket m√°s service-ekkel is meg szeretn√©nk osztani Kafka-n kereszt√ºl, akkor a <code>spring-modulith-events-kafka</code> f√ºgg≈ës√©get kell felvenn√ºnk: </p>
<pre class="astro-code github-light" style="background-color:#fff;color:#24292e;overflow-x:auto" tabindex="0" data-language="xml"><code><span class="line"><span style="color:#24292E">&lt;</span><span style="color:#22863A">dependency</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">	&lt;</span><span style="color:#22863A">groupId</span><span style="color:#24292E">&gt;org.springframework.modulith&lt;/</span><span style="color:#22863A">groupId</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">	&lt;</span><span style="color:#22863A">artifactId</span><span style="color:#24292E">&gt;spring-modulith-events-kafka&lt;/</span><span style="color:#22863A">artifactId</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">	&lt;</span><span style="color:#22863A">scope</span><span style="color:#24292E">&gt;runtime&lt;/</span><span style="color:#22863A">scope</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">&lt;/</span><span style="color:#22863A">dependency</span><span style="color:#24292E">&gt;</span></span>
<span class="line"></span></code></pre>
<p> Ekkor az <code>@Externalized</code> annot√°ci√≥val ell√°tott esem√©nyek (a p√©ld√°ban a <code>ShipmentCreatedEvent</code>) automatikusan tov√°bb√≠t√°sra ker√ºlnek egy Kafka sorra, ezt parancssori Kafka consumerrel ellen≈ërizhetj√ºk: </p>
<pre class="astro-code github-light" style="background-color:#fff;color:#24292e;overflow-x:auto" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#6F42C1">$</span><span style="color:#032F62"> docker</span><span style="color:#032F62"> exec</span><span style="color:#005CC5"> -it</span><span style="color:#032F62"> modulith-example-kafka-1</span><span style="color:#032F62"> /bin/bash</span></span>
<span class="line"><span style="color:#24292E">[appuser@1a22052f3675 </span><span style="color:#D73A49">~</span><span style="color:#24292E">]$ kafka-topics --list --bootstrap-server localhost:9092</span></span>
<span class="line"><span style="color:#6F42C1">shipment.event.ShipmentCreatedEvent</span></span>
<span class="line"><span style="color:#24292E">[appuser@1a22052f3675 </span><span style="color:#D73A49">~</span><span style="color:#24292E">]$ kafka-console-consumer --bootstrap-server localhost:9092 --topic shipment.event.ShipmentCreatedEvent --from-beginning</span></span>
<span class="line"><span style="color:#24292E">{</span><span style="color:#6F42C1">&quot;source&quot;</span><span style="color:#005CC5">:</span><span style="color:#032F62">{}</span><span style="color:#6F42C1">,</span><span style="color:#6F42C1">&quot;timestamp&quot;</span><span style="color:#6F42C1">:1734340362332}</span></span>
<span class="line"></span></code></pre>
<p> A fenti p√©ld√°ban l√°that√≥, hogy l√©trej√∂tt a <code>shipment.event.ShipmentCreatedEvent</code> Kafka topic √©s az esem√©ny is meg√©rkezett. </p>
<h2 id="forr√°sk√≥d" class="text-2xl font-bold my-2"> Forr√°sk√≥d </h2>
<p> A p√©lda projekt teljes forr√°sk√≥dja megtal√°lhat√≥ a <a href="https://github.com/pbes/modulith-example" href="https://github.com/pbes/modulith-example" class="text-blue-600 after:content-['_‚Üó']" target="_blank" rel="noopener noreferrer"> GitHub-on </a>. Az alkalmaz√°shoz sz√ºks√©ges f√ºgg≈ës√©gek (PostgreSQL, Kafka) a <code>compose.yaml</code> f√°jlban defini√°ltak, azok a <code>spring-boot-docker-compose</code> seg√≠ts√©g√©vel indulnak √©s √°llnak le automatikusan. </p>
<p> A p√©lda ezen fel√ºl tartalmazza m√©g a rendel√©s t√∂rl√©s√©hez sz√ºks√©ges logik√°t: </p>
<ul class="list-disc ml-6"> 
<li class="mb-1"> <code>CancelOrderAction</code>: √ºzleti logika a t√∂rl√©sre, ha nem l√©tezik vagy m√°r shipped √°llapot√∫ a rendel√©s, akkor hiba: nem t√∂r√∂lhet≈ë </li>
<li class="mb-1"> <code>OrderCanceledEvent</code>: sikeres t√∂rl√©s eset√©n ezt az esem√©nyt publik√°lja </li>
<li class="mb-1"> <code>OrderCancelledHandler</code>: a <code>shipment</code> package-ben figyeli az esem√©nyt √©s a hozz√° tartoz√≥ sz√°ll√≠tm√°nyokat is <code>CANCELLED</code> √°llapotba √°ll√≠tja </li>
 </ul> </div>  </div> <footer class="bg-gradient-to-t from-orange-50"> <div class="flex flex-row items-center justify-center max-w-screen-md h-96 mx-auto px-4 sm:px-6"> <p class="text-4xl leading-[60px] bg-clip-text text-center text-transparent bg-gradient-to-r from-orange-600 to-amber-600 font-title font-black"> Besz√©lj√ºnk a technol√≥gi√°r√≥l üöÄ </p> </div> </footer> </div> </body></html> 